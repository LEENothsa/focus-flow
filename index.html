<!DOCTYPE html>
<html lang="zh-CN">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, user-scalable=no, viewport-fit=cover">
    <title>FocusFlow - ä»ªå¼æ„Ÿæ‰‹ç»˜æ‰‹è´¦ç‰ˆ</title>
    <!-- PWA Essential Tags -->
    <link rel="manifest" href="manifest.json">
    <link rel="apple-touch-icon" href="icon.png">
    <meta name="apple-mobile-web-app-capable" content="yes">
    <meta name="apple-mobile-web-app-status-bar-style" content="default">
    <meta name="theme-color" content="#FAF8F5">
    
    <script src="https://cdn.tailwindcss.com"></script>
    <script src="https://unpkg.com/react@18/umd/react.production.min.js"></script>
    <script src="https://unpkg.com/react-dom@18/umd/react-dom.production.min.js"></script>
    <script src="https://unpkg.com/@babel/standalone/babel.min.js"></script>
    <style>
        @font-face { font-family: 'Handwritten'; src: local('PingFang SC'), local('Heiti SC'), sans-serif; }
        :root {
            --cream-bg: #FAF8F5;
            --text-main: #8E8B82;
            --text-muted: #C5C2BB;
            --border-light: #E8E5DE;
            --morandi-green: #BBCBC2;
            --accent-soft: #A7C4BC;
        }
        body { font-family: 'Handwritten', sans-serif; background-color: var(--cream-bg); margin: 0; padding: 0; display: flex; justify-content: center; align-items: center; height: 100vh; overflow: hidden; color: var(--text-main); touch-action: none; }
        #phone-container { width: 100%; max-width: 393px; height: 100%; max-height: 852px; background-color: var(--cream-bg); position: relative; overflow: hidden; display: flex; flex-direction: column; border: none; border-radius: 0; }
        .paper-overlay::before { content: ""; position: absolute; top: 0; left: 0; width: 100%; height: 100%; opacity: 0.3; pointer-events: none; background-image: url("https://www.transparenttextures.com/patterns/natural-paper.png"); z-index: 10; }
        .no-scrollbar::-webkit-scrollbar { display: none; }
        .btn-active:active { transform: scale(0.97); transition: 0.2s; }
        
        .sticker-wall-bg {
            background-image: radial-gradient(var(--border-light) 1px, transparent 1px);
            background-size: 20px 20px;
        }

        .polaroid-frame {
            background: white;
            padding: 12px 12px 48px 12px;
            box-shadow: 0 15px 40px rgba(0,0,0,0.12);
            transform: rotate(-1deg);
            border-radius: 4px;
        }
        
        @keyframes popIn {
            0% { transform: scale(0); opacity: 0; }
            80% { transform: scale(1.05); opacity: 1; }
            100% { transform: scale(1); opacity: 1; }
        }
        .animate-pop { animation: popIn 0.5s cubic-bezier(0.175, 0.885, 0.32, 1.275) forwards; }
        
        .draggable-sticker {
            touch-action: none;
            cursor: move;
            user-select: none;
            transition: transform 0.1s ease-out;
        }

        .settings-content {
            max-height: 0;
            overflow: hidden;
            transition: max-height 0.3s ease-out;
        }
        .settings-content.open {
            max-height: 700px;
        }

        input[type=range] {
            -webkit-appearance: none;
            width: 100%;
            background: transparent;
        }
        input[type=range]::-webkit-slider-runnable-track {
            width: 100%;
            height: 4px;
            cursor: pointer;
            background: #E8E5DE;
            border-radius: 2px;
        }
        input[type=range]::-webkit-slider-thumb {
            height: 18px;
            width: 18px;
            border-radius: 50%;
            background: #BBCBC2;
            cursor: pointer;
            -webkit-appearance: none;
            margin-top: -7px;
            box-shadow: 0 2px 4px rgba(0,0,0,0.1);
            border: 2px solid white;
        }

        .picker-container {
            height: 100px;
            overflow-y: scroll;
            scroll-snap-type: y mandatory;
            scrollbar-width: none;
        }
        .picker-container::-webkit-scrollbar { display: none; }
        .picker-item {
            height: 33.33px;
            display: flex;
            align-items: center;
            justify-content: center;
            scroll-snap-align: center;
            font-size: 14px;
            color: var(--text-muted);
            transition: color 0.2s;
        }
        .picker-item.active {
            color: var(--text-main);
            font-weight: bold;
            font-size: 16px;
        }

        .timer-circle {
            transition: stroke-dashoffset 0.5s linear;
        }
    </style>
</head>
<body>
    <div id="phone-container" class="paper-overlay">
        <div id="root" class="flex-1 flex flex-col h-full overflow-hidden z-20"></div>
    </div>

    <script type="text/babel">
        const { useState, useEffect, Fragment, useMemo, useRef } = React;

        // ç³»ç»Ÿé€šçŸ¥è¾…åŠ©å‡½æ•° - ç¡®ä¿ç³»ç»Ÿçº§é€šçŸ¥æƒé™
        const requestNotificationPermission = () => {
            if ("Notification" in window && Notification.permission !== "granted") {
                Notification.requestPermission();
            }
        };

        // å‘é€ç³»ç»Ÿé€šçŸ¥ (å³ä¾¿é”å±ä¹Ÿèƒ½æ˜¾ç¤ºï¼Œå–å†³äºOSæƒé™)
        const sendNotification = (title, body) => {
            if ("Notification" in window && Notification.permission === "granted") {
                new Notification(title, { body, icon: 'icon.png' });
            }
        };

        const Icon = ({ name, size = 24, fill = "none", className = "" }) => {
            const icons = {
                play: <path d="m6 3 14 9-14 9V3z" />,
                refresh: <path d="M21 12a9 9 0 1 1-9-9c2.52 0 4.93 1 6.74 2.74L21 8m0-5v5h-5" />,
                home: <path d="m3 9 9-7 9 7v11a2 2 0 0 1-2 2H5a2 2 0 0 1-2-2z" />,
                calendar: <Fragment><rect width="18" height="18" x="3" y="4" rx="2" /><path d="M16 2v4M8 2v4M3 10h18" /></Fragment>,
                timer: <Fragment><circle cx="12" cy="12" r="10" /><polyline points="12 6 12 12 16 14" /></Fragment>,
                award: <Fragment><circle cx="12" cy="8" r="7" /><path d="M8.21 13.89L7 23l5-3 5 3-1.21-9.11" /></Fragment>,
                chevronLeft: <path d="m15 18-6-6 6-6" />,
                chevronRight: <path d="m9 18 6-6 6-6" />,
                sparkle: <path d="m12 3-1.912 5.813a2 2 0 0 1-1.275 1.275L3 12l5.813 1.912a2 2 0 0 1 1.275 1.275L12 21l1.912-5.813a2 2 0 0 1 1.275-1.275L21 12l-5.813-1.912a2 2 0 0 1-1.275-1.275L12 3Z" />,
                settings: (
                    <Fragment>
                        <path d="M12.22 2h-.44a2 2 0 0 0-2 2v.18a2 2 0 0 1-1 1.73l-.43.25a2 2 0 0 1-2 0l-.15-.08a2 2 0 0 0-2.73.73l-.22.38a2 2 0 0 0 .73 2.73l.15.1a2 2 0 0 1 1 1.72v.51a2 2 0 0 1-1 1.74l-.15.09a2 2 0 0 0-.73 2.73l.22.38a2 2 0 0 0 2.73.73l.15-.08a2 2 0 0 1 2 0l.43.25a2 2 0 0 1 1 1.73V20a2 2 0 0 0 2 2h.44a2 2 0 0 0 2-2v-.18a2 2 0 0 1-1-1.73l.43-.25a2 2 0 0 1 2 0l.15.08a2 2 0 0 0 2.73-.73l.22-.39a2 2 0 0 0-.73-2.73l-.15-.08a2 2 0 0 1-1-1.74v-.5a2 2 0 0 1 1-1.74l.15-.09a2 2 0 0 0 .73-2.73l-.22-.38a2 2 0 0 0-2.73-.73l-.15.08a2 2 0 0 1-2 0l-.43-.25a2 2 0 0 1-1-1.73V4a2 2 0 0 0-2-2z"/>
                        <circle cx="12" cy="12" r="3" />
                    </Fragment>
                ),
                plus: <path d="M5 12h14M12 5v14" />,
                clock: <Fragment><circle cx="12" cy="12" r="10"/><polyline points="12 6 12 12 16 14"/></Fragment>,
                square: <rect x="3" y="3" width="18" height="18" rx="2" ry="2" />
            };
            return (
                <svg width={size} height={size} viewBox="0 0 24 24" fill={fill} stroke="currentColor" strokeWidth="1.5" strokeLinecap="round" strokeLinejoin="round" className={className}>
                    {icons[name]}
                </svg>
            );
        };

        const MASTER_TASKS = [
            "æ•´ç†ä¹¦æ¡Œä¸€è§’", "ç»™é˜³å°çš„èŠ±æµ‡æ°´", "å¬ä¸€é¦–çº¯éŸ³ä¹", "å–ä¸€æ¯æ¸©èœ‚èœœæ°´", "è§‚å¯Ÿçª—å¤–çš„äº‘", 
            "æ·±å‘¼å¸5æ¬¡", "å†™ä¸‹ä¸€ä»¶å¼€å¿ƒçš„äº‹", "åšä¸€æ¬¡è‚©é¢ˆæ‹‰ä¼¸", "å‰¥ä¸ªæ©™å­é—»é—»æœé¦™", "çœ‹ä¸€æœ¬é—²ä¹¦5åˆ†é’Ÿ",
            "æ•´ç†æ‰‹æœºç›¸å†Œ", "æ“¦æ‹­ç”µè„‘å±å¹•", "ç»™è€å‹å‘ä¸ªè¡¨æƒ…åŒ…", "æ´—ä¸ªè‹¹æœæ…¢æ…¢åƒ", "å†¥æƒ³ä¸€å°ä¼š"
        ];
        const STICKERS = ['ğŸ¥', 'ğŸ«§', 'ğŸ§¸', 'ğŸ®', 'ğŸ¨', 'ğŸ“', 'â˜ï¸', 'ğŸ’', 'ğŸ¦’', 'ğŸˆ', 'ğŸª', 'ğŸ¥¨', 'ğŸ±', 'ğŸŒµ', 'ğŸ©'];

        const WheelPicker = ({ range, selected, onSelect, unit }) => {
            const containerRef = useRef(null);
            useEffect(() => {
                if (containerRef.current) {
                    const index = range.indexOf(selected);
                    containerRef.current.scrollTop = index * 33.33;
                }
            }, [selected]);
            const handleScroll = () => {
                if (!containerRef.current) return;
                const scrollTop = containerRef.current.scrollTop;
                const index = Math.round(scrollTop / 33.33);
                if (range[index] !== undefined && range[index] !== selected) {
                    onSelect(range[index]);
                }
            };
            return (
                <div className="relative h-[100px] bg-white border border-[#E8E5DE] rounded-[12px] flex flex-col items-center overflow-hidden">
                    <div className="absolute top-[33.33px] left-0 right-0 h-[33.33px] border-y border-[#BBCBC2]/30 pointer-events-none bg-[#BBCBC2]/5" />
                    <div ref={containerRef} onScroll={handleScroll} className="picker-container w-full">
                        <div className="h-[33.33px]" />
                        {range.map(val => (
                            <div key={val} className={`picker-item ${val === selected ? 'active' : ''}`}>
                                {val.toString().padStart(2, '0')}{unit}
                            </div>
                        ))}
                        <div className="h-[33.33px]" />
                    </div>
                </div>
            );
        };

        const App = () => {
            const savedHistory = JSON.parse(localStorage.getItem('focusFlow_stickers') || '[]');
            const savedTodo = JSON.parse(localStorage.getItem('focusFlow_todo') || '[]');
            const savedActiveTask = localStorage.getItem('focusFlow_activeTask') || '';
            const savedIsActive = localStorage.getItem('focusFlow_isActive') === 'true';
            const savedTargetEndTime = parseInt(localStorage.getItem('focusFlow_targetEndTime') || '0');
            const savedInitialTime = parseInt(localStorage.getItem('focusFlow_initialTime') || '300');

            const [view, setView] = useState('home');
            const [isActive, setIsActive] = useState(savedIsActive);
            const [targetEndTime, setTargetEndTime] = useState(savedTargetEndTime);
            const [timeLeft, setTimeLeft] = useState(0);
            const [initialTime, setInitialTime] = useState(savedInitialTime); 

            const [startHour, setStartHour] = useState(new Date().getHours());
            const [startMinute, setStartMinute] = useState(new Date().getMinutes());
            const [taskInput, setTaskInput] = useState("");
            const [activeTask, setActiveTask] = useState(savedActiveTask);
            const [stickerHistory, setStickerHistory] = useState(savedHistory);
            const [postFocusModal, setPostFocusModal] = useState(false);
            const [polaroidModal, setPolaroidModal] = useState(false);
            const [pendingSticker, setPendingSticker] = useState(null);
            const [currentDate, setCurrentDate] = useState(new Date());
            const [selectedDate, setSelectedDate] = useState(new Date().toDateString());
            const [suggestedTasks, setSuggestedTasks] = useState([]);
            const [showSettings, setShowSettings] = useState(false);
            const [todoList, setTodoList] = useState(savedTodo);
            const [draggingId, setDraggingId] = useState(null);
            const wallRef = useRef(null);
            
            // è¿½è¸ªå·²å‘å‡ºçš„ä»»åŠ¡æé†’
            const alertedTasks = useRef(new Set());

            useEffect(() => {
                requestNotificationPermission();
            }, []);

            // æ ¸å¿ƒå®šæ—¶å™¨é€»è¾‘ï¼šå¤„ç†å€’è®¡æ—¶ä¸ä»»åŠ¡æ—¶é—´ç‚¹æé†’
            useEffect(() => {
                let timer;
                const checkStatus = () => {
                    const now = new Date();
                    const nowTs = now.getTime();

                    // å…¨å±€æé†’ 1: ä»»åŠ¡å¼€å§‹æ—¶é—´æé†’
                    const currentTimeStr = `${now.getHours().toString().padStart(2, '0')}:${now.getMinutes().toString().padStart(2, '0')}`;
                    todoList.forEach(item => {
                        const alertId = `${item.id}-${currentTimeStr}`;
                        if (item.time === currentTimeStr && !alertedTasks.current.has(alertId)) {
                            sendNotification("ä»»åŠ¡è¯¥å¼€å§‹äº†ï¼", `è®¡åˆ’ä¸­çš„ã€Œ${item.task}ã€å·²ç»åˆ°è¾¾è®¾å®šæ—¶é—´ã€‚`);
                            alertedTasks.current.add(alertId);
                        }
                    });

                    // å…¨å±€æé†’ 2: ä¸“æ³¨å€’è®¡æ—¶ç»“æŸæé†’
                    if (isActive && targetEndTime > 0) {
                        const remaining = Math.max(0, Math.ceil((targetEndTime - nowTs) / 1000));
                        setTimeLeft(remaining);

                        if (remaining <= 0) {
                            setIsActive(false);
                            setPostFocusModal(true);
                            localStorage.removeItem('focusFlow_targetEndTime');
                            sendNotification("ä¸“æ³¨å®Œæˆï¼", "å¿ƒæµä¹‹æ—…å·²ç»“æŸï¼Œæ¥æŠ½ä¸€å¼ è´´çº¸å¥–åŠ±è‡ªå·±å§ âœ¨");
                        }
                    } else if (!isActive && targetEndTime > 0) {
                        const remaining = Math.max(0, Math.ceil((targetEndTime - nowTs) / 1000));
                        setTimeLeft(remaining);
                    }
                };

                checkStatus();
                timer = setInterval(checkStatus, 1000);
                return () => clearInterval(timer);
            }, [isActive, targetEndTime, todoList]);

            // æ•°æ®æŒä¹…åŒ–
            useEffect(() => {
                localStorage.setItem('focusFlow_stickers', JSON.stringify(stickerHistory));
                localStorage.setItem('focusFlow_todo', JSON.stringify(todoList));
                localStorage.setItem('focusFlow_activeTask', activeTask);
                localStorage.setItem('focusFlow_isActive', isActive.toString());
                localStorage.setItem('focusFlow_targetEndTime', targetEndTime.toString());
                localStorage.setItem('focusFlow_initialTime', initialTime.toString());
            }, [stickerHistory, todoList, activeTask, isActive, targetEndTime, initialTime]);

            const startFocus = (task, duration = 300) => {
                const finalTask = task || taskInput || "éšå¿ƒä¸“æ³¨";
                const newTarget = Date.now() + (duration * 1000);
                setActiveTask(finalTask);
                setTargetEndTime(newTarget);
                setInitialTime(duration);
                setTimeLeft(duration);
                setIsActive(true);
                setView('focus');
                setPostFocusModal(false);
            };

            const toggleFocus = () => {
                if (isActive) {
                    setIsActive(false);
                } else {
                    const newTarget = Date.now() + (timeLeft * 1000);
                    setTargetEndTime(newTarget);
                    setIsActive(true);
                }
            };

            const refreshSuggestions = () => {
                const shuffled = [...MASTER_TASKS].sort(() => 0.5 - Math.random());
                setSuggestedTasks(shuffled.slice(0, 3));
            };
            useEffect(() => { refreshSuggestions(); }, []);

            const addToTodayList = () => {
                const task = taskInput || "æ–°çš„è§„åˆ’";
                const timeStr = `${startHour.toString().padStart(2,'0')}:${startMinute.toString().padStart(2,'0')}`;
                setTodoList([...todoList, { id: Date.now(), task, time: timeStr }]);
                setTaskInput("");
                setShowSettings(false);
            };

            const handleSurpriseMe = () => setTaskInput(MASTER_TASKS[Math.floor(Math.random() * MASTER_TASKS.length)]);

            const handleDrawSticker = () => {
                const icon = STICKERS[Math.floor(Math.random() * STICKERS.length)];
                const newSticker = { id: Date.now(), icon, task: activeTask, date: new Date().toDateString(), x: 50, y: 50, rotation: Math.random() * 20 - 10 };
                setPendingSticker(newSticker);
                setStickerHistory([...stickerHistory, newSticker]);
                setPostFocusModal(false);
                setPolaroidModal(true);
                
                // ç»“æŸå¹¶é‡è®¾å€’è®¡æ—¶
                setTargetEndTime(0);
                setTimeLeft(300);
                setInitialTime(300);
                setIsActive(false);
            };

            const onDragStart = (id) => setDraggingId(id);
            const onDragEnd = () => setDraggingId(null);
            const onDragMove = (e) => {
                if (!draggingId || !wallRef.current) return;
                const rect = wallRef.current.getBoundingClientRect();
                const clientX = e.touches ? e.touches[0].clientX : e.clientX;
                const clientY = e.touches ? e.touches[0].clientY : e.clientY;
                const x = Math.max(5, Math.min(95, ((clientX - rect.left) / rect.width) * 100));
                const y = Math.max(5, Math.min(95, ((clientY - rect.top) / rect.height) * 100));
                setStickerHistory(prev => prev.map(s => s.id === draggingId ? { ...s, x, y } : s));
            };

            const calendarDays = useMemo(() => {
                const year = currentDate.getFullYear();
                const month = currentDate.getMonth();
                const firstDay = new Date(year, month, 1).getDay();
                const daysInMonth = new Date(year, month + 1, 0).getDate();
                const days = [];
                for (let i = 0; i < (firstDay === 0 ? 6 : firstDay - 1); i++) days.push(null);
                for (let i = 1; i <= daysInMonth; i++) days.push(new Date(year, month, i));
                return days;
            }, [currentDate]);

            const stopFocus = () => {
                setIsActive(false);
                setTargetEndTime(0);
                setTimeLeft(300);
                setInitialTime(300);
                setView('home');
            };

            // ä¿®æ”¹ç‚¹ï¼šæ¯æ¬¡æ‰“å¼€è®¾ç½®é¢æ¿æ—¶ï¼Œæ›´æ–°ä¸ºå½“å‰çš„ç³»ç»Ÿæ—¶é—´
            const toggleSettings = () => {
                const nextState = !showSettings;
                if (nextState) {
                    const now = new Date();
                    setStartHour(now.getHours());
                    setStartMinute(now.getMinutes());
                }
                setShowSettings(nextState);
            };

            const radius = 110; 
            const circumference = 2 * Math.PI * radius;
            const strokeDashoffset = circumference - (timeLeft / initialTime) * circumference;

            return (
                <div className="flex-1 flex flex-col h-full overflow-hidden">
                    <div className="h-16 w-full flex-shrink-0 flex items-center justify-between px-8">
                        {view !== 'home' ? <button onClick={() => setView('home')} className="w-10 h-10 flex items-center justify-center text-[#8E8B82]"><Icon name="chevronLeft" size={20} /></button> : <div/>}
                        <button onClick={() => setView('logs')} className={`w-10 h-10 flex items-center justify-center ${view === 'logs' ? 'text-[#BBCBC2]' : 'text-[#8E8B82]'}`}><Icon name="calendar" size={18} /></button>
                    </div>

                    <main className="flex-1 overflow-y-auto no-scrollbar px-8 pb-10 relative">
                        {view === 'home' && (
                            <div className="animate-fadeIn space-y-8 mt-4">
                                <div className="flex justify-between items-start">
                                    <h1 className="text-[26px] font-normal text-[#8E8B82] leading-tight">ä¸“æ³¨ï¼Œ<br/>ä»5åˆ†é’Ÿå¼€å§‹</h1>
                                    <div className="text-right">
                                        <div className="text-[10px] text-[#C5C2BB] uppercase">ä»Šæ—¥ä»½è§„åˆ’</div>
                                        <div className="text-[16px] text-[#BBCBC2] font-bold">{todoList.length}</div>
                                    </div>
                                </div>
                                
                                <div className="space-y-4">
                                    <div className="bg-white border border-[#E8E5DE] rounded-[28px] shadow-sm flex items-center p-2 pr-4">
                                        <input type="text" value={taskInput} onChange={(e) => setTaskInput(e.target.value)} placeholder="ä»Šå¤©æƒ³ä¸“æ³¨åšç‚¹ä»€ä¹ˆï¼Ÿ" className="flex-1 bg-transparent py-3 px-4 text-[14px] text-[#8E8B82] focus:outline-none" />
                                        <div className="flex items-center gap-2">
                                            <button onClick={toggleSettings} className={`w-8 h-8 flex items-center justify-center ${showSettings ? 'text-[#BBCBC2]' : 'text-[#C5C2BB]'}`}><Icon name="settings" size={18} /></button>
                                            <button onClick={() => startFocus()} className="w-10 h-10 bg-[#BBCBC2] text-white rounded-full flex items-center justify-center btn-active shadow-sm"><Icon name="play" size={16} fill="white" /></button>
                                        </div>
                                    </div>

                                    <div className={`settings-content ${showSettings ? 'open' : ''} bg-[#FAF8F5]/50 rounded-[28px] border border-dashed border-[#E8E5DE]`}>
                                        <div className="p-6 space-y-6">
                                            <div className="space-y-3">
                                                <label className="text-[10px] text-[#C5C2BB] uppercase tracking-widest pl-1 font-bold">è®¾å®šå¼€å§‹æ—¶é—´</label>
                                                <div className="grid grid-cols-2 gap-4">
                                                    <WheelPicker range={Array.from({length: 24}, (_, i) => i)} selected={startHour} onSelect={setStartHour} unit="æ—¶" />
                                                    <WheelPicker range={Array.from({length: 60}, (_, i) => i)} selected={startMinute} onSelect={setStartMinute} unit="åˆ†" />
                                                </div>
                                                <button onClick={addToTodayList} className="w-full mt-2 py-3 bg-white border border-[#E8E5DE] text-[#8E8B82] rounded-[16px] text-[11px] flex items-center justify-center gap-2 btn-active">
                                                    <Icon name="plus" size={14} className="text-[#BBCBC2]" /> åŠ å…¥ä»Šæ—¥åˆ—è¡¨
                                                </button>
                                            </div>
                                        </div>
                                    </div>
                                </div>

                                <button onClick={handleSurpriseMe} className="w-full py-4 bg-white/50 border border-dashed border-[#E8E5DE] text-[#8E8B82] rounded-[24px] flex items-center justify-center gap-2 btn-active group">
                                    <Icon name="sparkle" size={16} className="text-[#BBCBC2]" /> <span className="text-[12px] tracking-widest">è¿˜æ²¡æœ‰çµæ„Ÿï¼Ÿéšä¾¿æ¥ä¸€ä¸ª</span>
                                </button>

                                {todoList.length > 0 ? (
                                    <div className="space-y-3">
                                        <div className="text-[10px] tracking-[0.2em] text-[#C5C2BB] uppercase pl-2 font-bold">è‡ªå®šä»»åŠ¡åˆ—è¡¨</div>
                                        {todoList.map((item) => (
                                            <div key={item.id} className="w-full py-4 px-5 bg-white border border-[#E8E5DE] rounded-[22px] flex items-center justify-between shadow-sm">
                                                <div className="flex flex-col">
                                                    <span className="text-[13px] text-[#8E8B82] font-medium">{item.task}</span>
                                                    <span className="text-[10px] text-[#C5C2BB]">ä»»åŠ¡å¼€å§‹ï¼š{item.time}</span>
                                                </div>
                                                <button onClick={() => startFocus(item.task)} className="w-9 h-9 bg-[#BBCBC2]/10 text-[#BBCBC2] rounded-full flex items-center justify-center btn-active"><Icon name="play" size={14} fill="currentColor" /></button>
                                            </div>
                                        ))}
                                    </div>
                                ) : (
                                    <div className="space-y-3">
                                        <div className="text-[10px] tracking-[0.2em] text-[#C5C2BB] uppercase pl-2">æ¨èå°ä»»åŠ¡</div>
                                        {suggestedTasks.map((t, idx) => (
                                            <button key={idx} onClick={() => startFocus(t)} className="w-full py-4 px-6 bg-white border border-[#E8E5DE] rounded-[22px] text-[13px] text-left text-[#8E8B82] flex justify-between items-center group shadow-sm">
                                                {t} <Icon name="play" size={12} className="opacity-0 group-hover:opacity-100 text-[#BBCBC2]" />
                                            </button>
                                        ))}
                                        <button onClick={refreshSuggestions} className="text-[11px] text-[#BBCBC2] flex items-center justify-center gap-1 w-full pt-1"><Icon name="refresh" size={12} /> æ¢ä¸€æ‰¹</button>
                                    </div>
                                )}
                            </div>
                        )}

                        {view === 'focus' && (
                            <div className="h-full flex flex-col items-center justify-center animate-fadeIn text-center pt-8">
                                <div className="mb-8">
                                    <div className="text-[10px] text-[#C5C2BB] uppercase tracking-[0.3em] mb-2">æ­£åœ¨ä¸“æ³¨</div>
                                    <h2 className="text-[20px] text-[#8E8B82] italic font-normal">{activeTask}</h2>
                                </div>
                                <div className="relative w-80 h-80 flex items-center justify-center mb-12">
                                    <svg className="absolute w-full h-full -rotate-90">
                                        <circle cx="160" cy="160" r={radius} stroke="#E8E5DE" strokeWidth="2" fill="transparent" strokeDasharray="4, 4" />
                                        <circle className="timer-circle" cx="160" cy="160" r={radius} stroke="#BBCBC2" strokeWidth="6" fill="transparent" strokeDasharray={circumference} strokeDashoffset={strokeDashoffset} strokeLinecap="round" />
                                    </svg>
                                    <div className="text-[72px] font-light text-[#8E8B82] tabular-nums tracking-tighter z-10">
                                        {Math.floor(timeLeft/60)}:{(timeLeft%60).toString().padStart(2,'0')}
                                    </div>
                                </div>
                                <div className="flex flex-col gap-6 w-full px-12 items-center">
                                    <button onClick={toggleFocus} className="w-full py-4 bg-[#BBCBC2] text-white rounded-[24px] text-[13px] tracking-widest btn-active shadow-md font-medium">
                                        {isActive ? "ç¨ä½œå–˜æ¯" : "ç»§ç»­å¿ƒæµ"}
                                    </button>
                                    <button onClick={stopFocus} className="text-[11px] text-[#DEDAD1] border-b border-transparent hover:border-current pb-0.5">ç»“æŸæœ¬æ¬¡ä¸“æ³¨</button>
                                </div>
                            </div>
                        )}

                        {view === 'growth' && (
                            <div className="h-full flex flex-col animate-fadeIn">
                                <div className="mb-6"><h2 className="text-[22px] text-[#8E8B82]">æ‰‹å¸å¢™</h2><p className="text-[10px] text-[#C5C2BB]">é•¿æŒ‰æ‹–æ‹½è´´çº¸ï¼Œå¸ƒç½®ä½ çš„ä¸“å±ç©ºé—´</p></div>
                                <div ref={wallRef} onMouseMove={onDragMove} onMouseUp={onDragEnd} onTouchMove={onDragMove} onTouchEnd={onDragEnd} className="flex-1 bg-white rounded-[32px] border-8 border-white shadow-inner sticker-wall-bg relative overflow-hidden">
                                    {stickerHistory.map(s => (
                                        <div key={s.id} onMouseDown={() => onDragStart(s.id)} onTouchStart={() => onDragStart(s.id)} className={`absolute draggable-sticker text-5xl select-none ${draggingId === s.id ? 'z-50 scale-125' : 'z-10'}`} style={{ left: `${s.x}%`, top: `${s.y}%`, transform: `translate(-50%, -50%) rotate(${s.rotation}deg)` }}>{s.icon}</div>
                                    ))}
                                </div>
                            </div>
                        )}

                        {view === 'logs' && (
                            <div className="animate-fadeIn">
                                <div className="mb-8 flex justify-between items-center">
                                    <h2 className="text-[18px] text-[#8E8B82] font-medium">{currentDate.getFullYear()}å¹´ {currentDate.getMonth()+1}æœˆ</h2>
                                    <div className="flex gap-4">
                                        <button onClick={()=>setCurrentDate(new Date(currentDate.setMonth(currentDate.getMonth()-1)))} className="text-[#C5C2BB]"><Icon name="chevronLeft" size={16}/></button>
                                        <button onClick={()=>setCurrentDate(new Date(currentDate.setMonth(currentDate.getMonth()+1)))} className="text-[#C5C2BB]"><Icon name="chevronRight" size={16}/></button>
                                    </div>
                                </div>
                                <div className="grid grid-cols-7 gap-1 text-center mb-8">
                                    {['ä¸€','äºŒ','ä¸‰','å››','äº”','å…­','æ—¥'].map(d=><div key={d} className="text-[10px] text-[#C5C2BB] py-2">{d}</div>)}
                                    {calendarDays.map((date, i) => {
                                        if(!date) return <div key={i}/>;
                                        const isSelected = selectedDate === date.toDateString();
                                        return <div key={i} onClick={()=>setSelectedDate(date.toDateString())} className={`aspect-square flex items-center justify-center rounded-xl text-[12px] cursor-pointer ${isSelected ? 'bg-[#BBCBC2] text-white' : 'text-[#8E8B82]'}`}>{date.getDate()}</div>;
                                    })}
                                </div>
                                <div className="border-t border-[#E8E5DE] pt-8">
                                    {stickerHistory.filter(h => h.date === selectedDate).length > 0 ? stickerHistory.filter(h => h.date === selectedDate).map(log => (
                                        <div key={log.id} className="bg-white/50 p-4 rounded-[20px] flex items-center gap-4 border border-[#E8E5DE] mb-3">
                                            <div className="text-2xl">{log.icon}</div>
                                            <p className="text-[13px] text-[#8E8B82] font-medium">{log.task}</p>
                                        </div>
                                    )) : <div className="text-center py-10 text-[13px] text-[#C5C2BB] italic">ä»Šå¤©ä¹Ÿæ˜¯ç¾ç¾çš„ä¼‘æ¯æ—¥å‘¢</div>}
                                </div>
                            </div>
                        )}
                    </main>

                    {postFocusModal && (
                        <div className="fixed inset-0 z-[100] bg-black/30 backdrop-blur-sm flex items-center justify-center p-8">
                            <div className="bg-white rounded-[40px] p-8 w-full animate-pop shadow-2xl text-center">
                                <div className="text-[40px] mb-4">âœ¨</div>
                                <h3 className="text-[18px] text-[#8E8B82] mb-2 font-bold">ä¸“æ³¨é˜¶æ®µå®Œæˆ</h3>
                                <div className="space-y-3 mb-6 mt-6">
                                    {[15, 30, 60].map(mins => (
                                        <button key={mins} onClick={() => startFocus(null, mins * 60)} className="w-full py-3 bg-[#BBCBC2]/10 text-[#BBCBC2] rounded-[18px] text-[13px] font-medium btn-active">æˆ‘è¿˜èƒ½åšæŒ {mins} åˆ†é’Ÿ</button>
                                    ))}
                                </div>
                                <button onClick={handleDrawSticker} className="w-full py-4 bg-[#BBCBC2] text-white rounded-[22px] text-[14px] font-bold btn-active shadow-lg">ç»“æŸä¸“æ³¨ï¼è’¸èšŒï¼</button>
                            </div>
                        </div>
                    )}

                    {polaroidModal && pendingSticker && (
                        <div className="fixed inset-0 z-[110] bg-[#EAE7E0] flex flex-col items-center justify-center p-10 animate-fadeIn">
                            <div className="polaroid-frame animate-pop mb-14 w-full max-w-[280px]">
                                <div className="aspect-square bg-[#FAF8F5] flex items-center justify-center text-[110px] sticker-wall-bg mb-5 overflow-hidden"><span>{pendingSticker.icon}</span></div>
                                <div className="px-1 text-left">
                                    <div className="text-[16px] text-[#8E8B82] font-medium leading-tight mb-4">ã€Œ{pendingSticker.task}ã€</div>
                                    <div className="flex justify-between items-center border-t border-[#F4F1EA] pt-3">
                                        <div className="text-[9px] text-[#C5C2BB] font-bold tracking-tighter uppercase">{new Date().toDateString()}</div>
                                        <div className="text-[9px] text-[#BBCBC2] font-black italic tracking-widest">FOCUS FLOW</div>
                                    </div>
                                </div>
                            </div>
                            <button onClick={() => { setPolaroidModal(false); setView('growth'); }} className="px-12 py-4 bg-white text-[#8E8B82] rounded-full text-[13px] font-bold shadow-sm border border-[#E8E5DE] btn-active">æ”¶è¿›æˆ‘çš„æ‰‹å¸å¢™</button>
                        </div>
                    )}

                    <nav className="bg-[#FAF8F5]/80 backdrop-blur-sm flex justify-around items-center pt-5 pb-10 border-t border-[#F4F1EA]">
                        <button onClick={()=>setView('home')} className={`flex flex-col items-center gap-1 ${view==='home'?'text-[#BBCBC2]':'text-[#DEDAD1]'}`}><Icon name="home" size={24}/><span className="text-[9px]">ä¸»é¡µ</span></button>
                        <button onClick={()=>setView('focus')} className={`flex flex-col items-center gap-1 ${view==='focus'?'text-[#BBCBC2]':'text-[#DEDAD1]'}`}><Icon name="timer" size={24}/><span className="text-[9px]">ä¸“æ³¨</span></button>
                        <button onClick={()=>setView('growth')} className={`flex flex-col items-center gap-1 ${view==='growth'?'text-[#BBCBC2]':'text-[#DEDAD1]'}`}><Icon name="award" size={24}/><span className="text-[9px]">æˆé•¿</span></button>
                    </nav>
                </div>
            );
        };

        ReactDOM.createRoot(document.getElementById('root')).render(<App />);
    </script>
</body>
</html>